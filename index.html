<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Market Alert</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#07174E" />

  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />

  <!-- Chart.js -->
  <script>
const API_URL =
  "https://market-data-proxy.vercel.app/api/market"; 
// (I’ll give you this endpoint below)

let chart;
const labels = [];
const niftyData = [];
const sensexData = [];

function initChart() {
  const ctx = document.getElementById("marketChart").getContext("2d");
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [
        {
          label: "Nifty",
          data: niftyData,
          borderColor: "#0F9D58",
          tension: 0.4
        },
        {
          label: "Sensex",
          data: sensexData,
          borderColor: "#C41B46",
          tension: 0.4
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });
}

async function fetchMarket() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();

    const nifty = data.nifty;
    const sensex = data.sensex;

    document.getElementById("niftyVal").innerText = nifty;
    document.getElementById("sensexVal").innerText = sensex;

    const time = new Date().toLocaleTimeString();
    labels.push(time);
    niftyData.push(nifty);
    sensexData.push(sensex);

    if (labels.length > 10) {
      labels.shift();
      niftyData.shift();
      sensexData.shift();
    }

    chart.update();
  } catch (e) {
    console.error("Market fetch failed", e);
  }
}

window.onload = () => {
  initChart();
  fetchMarket();
  setInterval(fetchMarket, 300000); // every 5 min
};
</script>

  let nifty = 21570;
  let sensex = 71023;

  const labels = [];
  const niftyData = [];
  const sensexData = [];

  const ctx = document.getElementById("marketChart").getContext("2d");
  const chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [
        {
          label: "Nifty",
          data: niftyData,
          borderColor: "#0F9D58",
          tension: 0.4
        },
        {
          label: "Sensex",
          data: sensexData,
          borderColor: "#C41B46",
          tension: 0.4
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });

  function updateMarket() {
    nifty += (Math.random() - 0.5) * 200;
    sensex += (Math.random() - 0.5) * 600;

    nifty = Math.round(nifty);
    sensex = Math.round(sensex);

    document.getElementById("niftyVal").innerText = nifty;
    document.getElementById("sensexVal").innerText = sensex;

    const time = new Date().toLocaleTimeString();

    labels.push(time);
    niftyData.push(nifty);
    sensexData.push(sensex);

    if (labels.length > 10) {
      labels.shift();
      niftyData.shift();
      sensexData.shift();
    }

    chart.update();

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${time}</td>
      <td>${nifty}</td>
      <td>${sensex}</td>
    `;
    document.getElementById("historyTable").prepend(row);
  }

  function setAlert() {
    document.getElementById("statusBox").innerHTML =
      "<div class='success'>✅ Alert set successfully</div>";
  }

  updateMarket();
  setInterval(updateMarket, 300000); // 5 minutes
</script>

</body>
</html>
